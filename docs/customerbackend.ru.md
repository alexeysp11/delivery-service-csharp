# customer backend 

Доступно на других языках: [English/Английский](customerbackend.md), [Russian/Русский](customerbackend.ru.md). 

Бэкенд сервис приложения для потребителей 

## Требования к системе и его описание 

Общая модель системы: 

![system_overall](img/system_overall.png)

### Клиентское приложение

Описание приложения для потребителей: 
- Часть высоконагруженной системы: каждый элемент системы должен быть способен выдержать нагрузку до 5 тыс. запросов в секунду на запись и чтение.
- Интегрируется напрямую с [authentication API](authapi.ru.md), [customer backend](customerbackend.ru.md), [file service](fileservice.ru.md), statistical model, predictive model, [email sender](emailsender.ru.md), [push notifications](pushnotifications.ru.md).
- Отображение меню: 
    - Выгружается из бэкенда: категории, отдельные позиции (наименование, картинка, цена, описание);
    - Указывается пользователем: размер, количество.
- Оформление заказа:
    - Вводит пользователь: список выбранных позиций из меню, место доставки;
    - Высчитывается на бэкенде: общая сумма заказа, ориентировочное время готовки и доставки.
- Использование предиктивных моделей: ориентировочное время готовки и доставки.
- Отслеживание статуса заказа (изготовление, доставка + отдаленность курьера в метрах и/или минутах).
- Виды оплаты: 
    - наличная при получении, 
    - через валидатор при получении, 
    - через приложение банка по QR-коду,
    - в приложении с помощью CVC.
- Загрузка файлов на сервер (изображения, видео, Word, Excel, PDF).
- Загрузка файлов с сервера (изображения, Word, Excel, PDF).
- Формирование QR-кода для оплаты.
- Отправка уведомлений об акциях на почту и/или на телеграм.
- Отображение информации по предыдущим заказам в виде списков: 
    - список всех заказов, 
    - информация по конкретному заказу: 
        - фактическое время оформления, готовки и доставки; 
        - ориентировочное время готовки и доставки, 
        - общая сумма заказа, 
        - стоимость позиций заказа, 
        - место доставки; 
        - статус.
- Статистика по предыдущим заказам в виде дашбордов: 
    - по времени: 
        - день, 
        - неделя,
        - месяц,
        - год,
        - всё время; 
    - по типу графиков:
        - Line chart,
        - Bar chart,
        - Histogram,
        - Scatter plot и т.д.; 
    - метрики:
        - общая сумма заказа,
        - стоимость позиции,
        - количество заказов,
        - количество позиций,
        - время оформления заказов,
        - место доставки.
- Страница настроек и персональных данных: 
    - логин, 
    - email,
    - телефон,
    - пароль,
    - подключенные мессенджеры: WhatsApp, Viber, Telegram,
    - никнейм в Telegram,
    - предпочитаемый способ связи: эл.почта, телефон, один из мессенджеров,
    - место доставки по умолчанию,
    - предпочитаемый вид оплаты,
    - привязанные карты.

### Бэкенд-сервис

Понимание того, как будет использоваться клиентское приложение, позволяет сформировать требования к его основному бэкенд-сервису. 

Описание бэкенда приложения для потребителей: 
- Слушает очередь сообщений, в которую записываются сообщения об изменениях в пользователях и токенах, хранящихся модулем [authentication API](authapi.ru.md).
- Записывает в очередь сообщений информацию об изменениях в пользователях и токенах (очередь слушает модуль [authentication API](authapi.ru.md)).
- При запросах от клиентского приложения, проверяет сессионный токен.
- Выгрузка информации для отчетов по заказам: список всех заказов, информация по конкретному заказу (фактическое время оформления, готовки и доставки; ориентировочное время готовки и доставки, общая сумма заказа, стоимость позиций заказа, место доставки; статус).
- Интеграция с сервисами оплаты (по видам оплаты, указанным ранее).
- Поля пользователя: 
    - логин, 
    - email, 
    - телефон, 
    - пароль,
    - GUID пользователя.
- Поля временного пользователя: 
    - логин, 
    - email, 
    - телефон, 
    - пароль,
    - GUID пользователя,
    - ИД старой записи для деактивации.
